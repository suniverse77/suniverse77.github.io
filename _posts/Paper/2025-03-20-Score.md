---
title: "[ë…¼ë¬¸ë¦¬ë·°] Score-Based Generative Modeling through Stochastic Differential Equations"
date: 2025-03-20 12:00:00 +/-TTTT
categories: [ë…¼ë¬¸ë¦¬ë·°, Generative AI]
tags: [Diffusion, Image Generation]
math: true
toc: true
author: sunho
description: ğŸ“ ICLR 2021
---

[[Paper]](https://arxiv.org/abs/2011.13456)
[[GitHub]](https://github.com/yang-song/score_sde)

<details>
<summary><font color='#FF8C00'>ğŸ“ Summary</font></summary>
<div markdown="1">
<br>
í•˜ë‚˜ì˜ ëª¨ë¸ì„ í•™ìŠµí•´ë‘ë©´, ì´í›„ ìƒì„± ë‹¨ê³„ì—ì„œ ì›í•˜ëŠ” ìƒ˜í”Œë§ ê²½ë¡œ(ê¸¸ì´/ê°„ê²©)ë¥¼ ì„ íƒí•˜ì—¬ ìœ ì—°í•˜ê³  ë¹ ë¥´ê²Œ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

</div>
</details>

## Introduction

Score Matching with Langevin Dynamics (SMLD)ëŠ” ê° ë…¸ì´ì¦ˆ ìˆ˜ì¤€ì—ì„œ ë°ì´í„°ì— ëŒ€í•œ scoreë¥¼ ì¶”ì •í•˜ê³ , ìƒì„± ì‹œì—ëŠ” ì ì°¨ ë…¸ì´ì¦ˆê°€ ì¤„ì–´ë“œëŠ” ê³¼ì •ì„ ë”°ë¼ Langevin dynamicsë¡œ ìƒ˜í”Œì„ ìƒì„±í•œë‹¤.

Denoising Diffusion Probabilistic Models (DDPM)ëŠ” ì—­ë¶„í¬ì˜ í•¨ìˆ˜ì  í˜•íƒœë¥¼ ì•Œê³  ìˆë‹¤ëŠ” ê°€ì • í•˜ì— ë…¸ì´ì¦ˆê°€ ì¶”ê°€ë˜ëŠ” ê° ë‹¨ê³„ë¥¼ ì—­ì „ì‹œí‚¤ëŠ” í™•ë¥  ëª¨ë¸ì„ í•™ìŠµí•œë‹¤. ì—°ì†ì ì¸ ìƒíƒœ ê³µê°„ì—ì„œëŠ” DDPMì˜ í•™ìŠµ ëª©ì  í•¨ìˆ˜ê°€ ê° ë…¸ì´ì¦ˆ ìˆ˜ì¤€ì˜ ìŠ¤ì½”ì–´ë¥¼ ì•”ë¬µì ìœ¼ë¡œ ê³„ì‚°í•˜ê²Œ ëœë‹¤.

ì´ëŸ¬í•œ ì´ìœ ë¡œ ìœ„ ë‘ ëª¨ë¸ì„ í†µí‹€ì–´ score-based generative modelsì´ë¼ê³  ë¶€ë¥¸ë‹¤.

**ì œì•ˆí•˜ëŠ” ë°©ë²•**

ìŠ¤ì½”ì–´ ê¸°ë°˜ ìƒì„± ëª¨ë¸ì˜ ìƒˆë¡œìš´ ìƒ˜í”Œë§ ë°©ë²•ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ê¸° ìœ„í•´, ê¸°ì¡´ ì ‘ê·¼ ë°©ì‹ì„ SDE ê´€ì ì—ì„œ ì¼ë°˜í™”í•˜ëŠ” í†µí•© í”„ë ˆì„ì›Œí¬ë¥¼ ì œì•ˆí•œë‹¤.

<details>
<summary><font color='purple'>SDE (Stochastic Differential Equation)</font></summary>
<div markdown="1">

![fig1](paper/Score Diffusion-1.png){: style="display:block; margin:0 auto; width:100%;"}

<br>
ë¯¸ë¶„ë°©ì •ì‹ì´ë€ ë¯¸ë¶„ì„ í¬í•¨í•˜ëŠ” ë°©ì •ì‹ìœ¼ë¡œ, ì–´ë–¤ ê°’ $y$ê°€ ì‹œê°„ì— ë”°ë¼ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ë¥¼ ìˆ˜ì‹ìœ¼ë¡œ í‘œí˜„í•œ ê²ƒì´ë‹¤.

$$
\frac{dx}{dt}=f(x,t)
$$

ìœ„ì˜ ì‹ì—ì„œ $f(x,t)$ëŠ” ì‹œê°„ $t$ì— ë”°ë¥¸ $y$ì˜ ë³€í™”ìœ¨ì„ ì˜ë¯¸í•œë‹¤.

ë¯¸ë¶„ë°©ì •ì‹ì„ í’€ë©´ $x(t)$ë¥¼ êµ¬í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì‹œê°„ $t$ì— ë”°ë¥¸ ìƒíƒœê°’ì„ ì˜ë¯¸í•œë‹¤.

ë³€ìˆ˜ í•˜ë‚˜ì— ëŒ€í•´ì„œë§Œ ë¯¸ë¶„ì´ ì¼ì–´ë‚˜ëŠ” ë¯¸ë¶„ë°©ì •ì‹ì„ ODEë¼ê³  ë¶€ë¥¸ë‹¤.

---

SDEëŠ” ì•„ë˜ì™€ ê°™ì´ ODEì—ì„œ randomnessê°€ ì¶”ê°€ëœ í˜•íƒœì´ë‹¤.

$$
\underbrace{d\mathbf x=\mathbf f(\mathbf x,t)dt}_{\text{ODE}}+\underbrace{g(t)d\mathbf w}_{\text{Randomness}}
$$

Randomness ë•Œë¬¸ì— ì‹œê°„ì˜ íë¦„ì— ë”°ë¼ processê°€ í•­ìƒ ê°™ì€ ê²ƒì´ ì•„ë‹ˆë¼ ì¡°ê¸ˆì”© ë‹¬ë¼ì§„ë‹¤.

ì¦‰, SDEë¥¼ í’€ë©´ ì—¬ëŸ¬ ê°œì˜ í™•ë¥ ì ì¸ ê²½ë¡œ(Stochastic process) ì¤‘ í•˜ë‚˜ì˜ ê²½ë¡œê°€ ë‚˜ì˜¨ë‹¤.

$f(\mathbf x,t)$, $g(t)$ëŠ” ì‚¬ì „ì— ì •ì˜ëœ í•¨ìˆ˜ë¡œ í•™ìŠµ íŒŒë¼ë¯¸í„°ê°€ ì—†ìœ¼ë©°, ì´ forward processëŠ” ì…ë ¥ ë°ì´í„°ì™€ ë¬´ê´€í•˜ê²Œ ë°ì´í„°ë¥¼ ë¬´ì‘ìœ„ ë…¸ì´ì¦ˆë¡œ ë°”ê¾¼ë‹¤.

</div>
</details>

![fig2](paper/Score Diffusion-2.png){: style="display:block; margin:0 auto; width:90%;"}

## Methods

### 1. Score-based Generative Modeling with SDEs

#### Perturbing Data with SDEs

Diffusion processëŠ” ì•„ë˜ì˜ $\text{It\hat{o} SDE}$ì˜ í•´ë¡œ ëª¨ë¸ë§ë  ìˆ˜ ìˆë‹¤.

$$
d\mathbf{x}=\mathbf{f}(\mathbf{x},t)dt+g(t)d\mathbf{w}
$$

ì´í›„ë¶€í„° ì•„ë˜ì˜ notationì„ ì‚¬ìš©í•œë‹¤.

- $p_t(\mathbf{x})$: $\mathbf{x}(t)$ì˜ í™•ë¥  ë°€ë„ í•¨ìˆ˜
- $p_{st}(\mathbf{x}(t)\mid\mathbf{x}(s))$: $\mathbf{x}(s)$ì—ì„œ $\mathbf{x}(t)$ë¡œì˜ transition kernel

#### Generating Samples by Reversing the SDE

Reverse-time SDEëŠ” ì•„ë˜ì™€ ê°™ì´ ì£¼ì–´ì§„ë‹¤.

$$
d\mathbf{x}=
\left[
\mathbf{f}(\mathbf{x},t)-g(t)^2\nabla_{\mathbf{x}}\log p_t(\mathbf{x})
\right]dt+g(t)d\bar{\mathbf{w}}
$$

ì—¬ê¸°ì„œ $\bar{\mathbf{w}}$ëŠ” $T\to0$ì²˜ëŸ¼ ì‹œê°„ì´ ì—­ìœ¼ë¡œ íë¥¼ ë•Œì˜ standard Wiener processë¥¼, $dt$ëŠ” ë§¤ìš° ì‘ì€ negative timestepì„ ì˜ë¯¸í•œë‹¤.

ê° $t$ì—ì„œ marginal ë¶„í¬ì˜ score $\nabla_{\mathbf{x}}\log p_t(\mathbf{x})$ë¥¼ ëª¨ë‘ ì•Œê³  ìˆë‹¤ë©´, ìœ„ì˜ ì‹ì„ í†µí•´ reverse diffusion processë¥¼ ìœ ë„í•  ìˆ˜ ìˆìœ¼ë©°, $\mathbf{x}_0$ ë˜í•œ ìƒ˜í”Œë§í•  ìˆ˜ ìˆë‹¤.

#### Estimating Scores for the SDE

í™•ë¥  ë¶„í¬ì˜ scoreëŠ” score matchingì„ ì‚¬ìš©í•˜ì—¬ í•™ìŠµëœ score-based ëª¨ë¸ì„ í†µí•´ ì¶”ì •í•  ìˆ˜ ìˆë‹¤.

Scoreë¥¼ ì¶”ì •í•˜ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì€ ì†ì‹¤í•¨ìˆ˜ë¥¼ ìµœì†Œí•˜í•˜ì—¬ í•™ìŠµí•œë‹¤.

$$
\boldsymbol{\theta}^*=\underset{\boldsymbol{\theta}}{\arg\min}~\mathbb{E}_t 
\left\{
\lambda(t)\mathbb{E}_{\mathbf{x}(0)}\mathbb{E}_{\mathbf{x}(t) \mid \mathbf{x}(0)}
\left[\lVert
\mathbf{s}_{\boldsymbol{\theta}}(\mathbf{x}(t), t)
- \nabla_{\mathbf{x}(t)} \log p_{0t}(\mathbf{x}(t) \mid \mathbf{x}(0)) 
\rVert_2^2\right]
\right\}
$$

ì¶©ë¶„í•œ ë°ì´í„°ì™€ ëª¨ë¸ ìš©ëŸ‰ì´ ìˆë‹¤ë©´, score matchingì€ ëª¨ë“  $\mathbf{x}\_t$ì™€ $t$ì— ëŒ€í•´ì„œ optimal solution $\mathbf{s}\_{\boldsymbol{\theta}^*}(\mathbf{x}, t)$ì™€ $\nabla_{\mathbf{x}(t)}\log p_t(\mathbf{x})$ë¥¼ ë™ì¼í•˜ê²Œ ë§Œë“¤ì–´ ì¤€ë‹¤.

SMLDì™€ DDPMì—ì„œì™€ ê°™ì´ ì¼ë°˜ì ìœ¼ë¡œ ì•„ë˜ì˜ ê°’ì„ ì„ íƒí•œë‹¤.

$$
\lambda \propto \frac{1}{\mathbb{E} \left[
\left\| \nabla_{\mathbf{x}(t)} \log p_{0t}(\mathbf{x}(t) \mid \mathbf{x}(0)) \right\|_2^2
\right]}
$$

#### Examples: VE, VP SDEs and Beyond

SMLDì™€ ê°™ì€ NCSN ëª¨ë¸ì˜ ê³„ì—´ì—ì„œ ì‚¬ìš©í•˜ëŠ” forward SDE í˜•íƒœëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

$$
d\mathbf x=\sqrt{\frac{d[\sigma^2(t)]}{dt}}d\mathbf w
$$

timestep $t$ê°€ ì»¤ì§ˆìˆ˜ë¡ ë¶„ì‚°ì´ ì ì  ì»¤ì§„ë‹¤. â†’ Variance Exploding SDE (VE-SDE)

DDPMì—ì„œ ì‚¬ìš©í•˜ëŠ” forward SDE í˜•íƒœëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

$$
d\mathbf x=-\frac{1}{2}\beta(t)\mathbf xdt
+\sqrt{\beta(t)}d\mathbf w
$$

$\beta(t)$ì— ë”°ë¼ ë¶„ì‚°ì´ ì¼ì •í•˜ê²Œ ìœ ì§€ëœë‹¤. â†’ Variance Preserving SDE (VP-SDE)

### 2. Solving the Reverse SDE

Score-based ëª¨ë¸ $\mathbf{x}_\theta$ê°€ í•™ìŠµë˜ì—ˆë‹¤ë©´ ì´ë¥¼ ì‚¬ìš©í•´ reverse-time SDEë¥¼ êµ¬í•  ìˆ˜ ìˆìœ¼ë©°, ìˆ˜ì¹˜ì ì¸ ì ‘ê·¼ì„ í†µí•´ $p_0$ë¡œë¶€í„° ìƒ˜í”Œì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

ì•„ë˜ëŠ” reverse-time SDEë¥¼ êµ¬í•˜ê¸° ìœ„í•œ ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ì´ë‹¤.

- General-purpose Numerical SDE Solvers

    Euler-Maruyama, stochastic Runge-Kuttaì™€ ê°™ì€ ì¼ë°˜ì ì¸ ìˆ˜ì¹˜ì  SDE solverë¥¼ ì ìš©í•˜ì—¬ ì—­ë°©í–¥ SDEë¥¼ ì§ì ‘ ì‹œë®¬ë ˆì´ì…˜í•œë‹¤.
- Predictor-Corrector (PC) Sampler

    ìˆ˜ì¹˜ í•´ì„ìœ¼ë¡œ ì˜ˆì¸¡í•œ ë‹¤ìŒ, Langevin dynamicsì™€ ê°™ì€ score ê¸°ë°˜ MCMCë¥¼ ì‚¬ìš©í•´ ë¶„í¬ë¥¼ ë³´ì •í•¨ìœ¼ë¡œì¨ ìƒ˜í”Œ í’ˆì§ˆì„ ë†’ì¸ë‹¤.
- Probability Flow ODE

    Revser-time SDEì™€ ë™ì¼í•œ ì£¼ë³€ ë¶„í¬ë¥¼ ë”°ë¥´ëŠ” deterministicí•œ ODEë¥¼ ì •ì˜í•˜ê³ , ì´ë¥¼ Neural ODE ë°©ì‹ìœ¼ë¡œ í•´ê²°í•˜ì—¬ ìƒ˜í”Œì„ ìƒì„±í•˜ê³  likelihood ê³„ì‚°ë„ ìˆ˜í–‰í•œë‹¤.
- ì•„í‚¤í…ì²˜ ê°œì„ 

    VE/VP/sub-VP SDEì— ì í•©í•˜ë„ë¡ ì„¤ê³„ëœ NCSN++, DDPM++ ë“±ì˜ ìƒˆë¡œìš´ ë„¤íŠ¸ì›Œí¬ ì•„í‚¤í…ì²˜ë¥¼ í†µí•´ ìƒ˜í”Œ í’ˆì§ˆ ë° likelihoodë¥¼ í–¥ìƒì‹œí‚¨ë‹¤.

## Experiments

![fig3](paper/Score Diffusion-3.png){: style="display:block; margin:0 auto; width:100%;"}
